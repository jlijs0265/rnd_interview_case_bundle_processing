## Bundle Processor

### 소스 파일 구성

* bundle_processor.py : 묶음(Bundle)간 배송지(WayPoint)를 재분배하는 알고리즘
* clustering.py : k-means 클러스터링 알고리즘
* Common.py : timestamp <> 날짜, 시간 문자열 간 변환을 위한 보조기능
* resources/sample_bundles.json : 샘플 묶음 데이터
* outputs/bundle_before.png : 묶음 데이터 재조정 전 분포 (예시)
* outputs/bundle_after.png : 묶음 데이터 재조정 후 분포 (예시)

### bundle_processor 주요 구성요소

* Location : 위치 객체
* WayPoint : (당일배송 주문의) 배송지 객체
* Cluster : bundle 내의 waypoints를 지리적 인접도를 기준으로 분할하여 저장하는 객체
* Bundle : (당일배송 주문) 묶음 객체
    * cluster_waypoints : waypoints를 지리적 인접도를 기준으로 분할
    * evaluate_clusters_and_sort : 각 cluster의 지리적 인접도를 기준으로 cost를 부여하고 정렬
    * set_outliers : 지리적 인접도를 기준으로 부여된 cost가 높은 cluster를 분류
    * remove_cluster : bundle에서 cluster 단위로 waypoints를 제거
    * append_cluster : bundle에서 cluster 단위로 waypoints를 추가
    * sort_waypoints_with_two_opt : two-opt 알고리즘을 이용하여 waypoints의 방문 순서를 이동거리가 최소화되도록 정렬
    * update_waypoints_distance_and_time : waypoints를 순서대로 방문하는 조건으로 waypoints간 거리와 이동시간 계산
* BundlePostProcessor : 묶음 재조정 로직을 관리하는 객체
    * relocate_outliers : bundle간 waypoints를 cluster단위로 이동하여 묶음 내 waypoints의 지리적 밀집도를 개선
    * process_bundles : 10초 제한시간동안 relocate_outliers를 최대 5회 반복

### 실행 환경 및 방법

* python3.x (python 3.10 미지원)
* requirements
```
pip install -r requirements.txt
```

* 실행
```
python bundle_processor.py
```

### sample data
서초구의 단일 허브에서 출발하여 서울 및 인근 지역으로 당일배송하는 임의의 1201개의 주문을 29명의 배송원에게 권역별로 예상소요시간 기준으로 균등분배하도록 초벌계산한 30개의 배송 묶음

```
번호       권역       주문 수     배차시각    픽업시각    종료시각    소요시간
1         9         42        16:30:00  16:53:48  23:26:03  6.93
2         9         41        16:30:00  16:53:18  22:46:59  6.28
3         9         43        16:30:00  16:54:18  22:45:31  6.26
4         9         47        16:30:00  16:56:18  22:48:04  6.30
5         9         43        16:30:00  16:54:18  23:08:07  6.64
6         9         42        16:30:00  16:53:48  22:35:43  6.10
7         9         45        16:30:00  16:55:18  23:25:14  6.92
8         9         46        16:30:00  16:55:48  23:06:40  6.61
9         9         51        16:30:00  16:58:18  23:30:18  7.01
10        9         44        16:30:00  16:54:48  23:11:03  6.68
11        9         36        16:30:00  16:50:48  23:00:06  6.50
12        9         41        16:30:00  16:53:18  23:02:41  6.54
13        9         48        16:30:00  16:56:48  23:41:04  7.18
14        9         40        16:30:00  16:52:48  23:10:42  6.68
15        9         42        16:30:00  16:53:48  23:02:52  6.55
18        8         40        16:30:00  16:52:48  22:44:33  6.24
19        8         36        16:30:00  16:50:48  22:47:01  6.28
20        8         40        16:30:00  16:52:48  22:42:22  6.21
21        8         42        16:30:00  16:53:48  22:57:07  6.45
22        8         39        16:30:00  16:52:18  23:06:17  6.60
23        8         39        16:30:00  16:52:18  22:37:05  6.12
24        8         47        16:30:00  16:56:18  23:09:42  6.66
25        8         41        16:30:00  16:53:18  22:32:51  6.05
26        8         41        16:30:00  16:53:18  22:26:29  5.94
27        8         39        16:30:00  16:52:18  22:44:25  6.24
28        8         37        16:30:00  16:51:18  22:52:55  6.38
29        8         40        16:30:00  16:52:48  22:33:20  6.06
30        8         42        16:30:00  16:53:48  22:42:48  6.21
31        9         24        16:30:00  16:44:48  22:36:22  6.11
32        8         3         16:30:00  16:34:18  17:25:55  0.93
```

### units

* 시간 데이터는 초 단위의 unix timestamp를 사용하며, 알고리즘에서 계산되는 시간은 현재 시각을 0초로 하는 상대시간
* 주요 물리량 단위
	* 시간 - 초
	* 거리 - km
	* 부피 - L
	* 무게 - kg
	* 속도 - km/h
